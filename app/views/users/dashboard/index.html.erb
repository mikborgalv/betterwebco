<div class="container my-5">
  <h2 class="text-light text-center mb-4">Welcome, <%= current_user.email %></h2>

  <% if @account.present? %>
    <!-- User Subscription Overview -->
    <div class="card bg-dark text-light shadow p-4 mb-5">
      <h4>Your Subscription</h4>
      <p><strong>Plan:</strong> <%= @account.plan_name %></p>
      <p><strong>Status:</strong> <%= @account.status %></p>
      <p><strong>Price:</strong> $<%= @account.price %>/month</p>
    </div>

    <!-- Projects Section -->
<div class="card bg-dark text-light shadow p-4">
  <h4>Your Projects</h4>

  <% if @account.projects.any? %>
    <ul class="list-group list-group-flush" id="projects-list">
      <% @account.projects.each do |project| %>
        <li class="list-group-item bg-dark text-light">
          <strong><%= project.name %></strong>
          <span class="badge bg-secondary ms-2"><%= project.status %></span><br>
          <small><%= project.description %></small>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p class="text-muted">No projects yet.</p>
  <% end %>

  <!-- New Project Form -->
  <%= form_with model: [:users, Project.new], local: true, class: "mt-4" do |f| %>
    <div class="mb-3">
      <%= f.label :name, class: "form-label" %>
      <%= f.text_field :name, class: "form-control bg-dark text-light" %>
    </div>
    <div class="mb-3">
      <%= f.label :description, class: "form-label" %>
      <%= f.text_area :description, rows: 2, class: "form-control bg-dark text-light" %>
    </div>
    <div class="mb-3">
      <%= f.label :status, class: "form-label" %>
      <%= f.select :status, ["in progress", "completed", "on hold"],
            {}, class: "form-select bg-dark text-light" %>
    </div>
    <%= f.submit "Add Project", class: "btn btn-primary" %>
  <% end %>
</div>


  <% else %>
    <!-- Show Subscription Plans -->
    <div class="row justify-content-center g-3">
      <% @plans.each do |plan| %>
        <div class="col-md-4">
          <div class="card bg-dark text-light shadow-sm h-100">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title"><%= plan[:name] %></h5>
              <p class="card-text"><%= plan[:description] %></p>
              <p class="card-text fw-bold">$<%= plan[:price] %> / month</p>

              <%= button_to "Subscribe", users_dashboard_subscribe_path(plan: plan[:name]),
                    method: :post,
                    class: "btn btn-primary mt-auto",
                    data: { turbo_frame: "subscription" } %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

<turbo-frame id="subscription"></turbo-frame>
